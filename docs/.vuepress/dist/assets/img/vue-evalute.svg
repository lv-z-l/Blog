<svg id="SvgjsSvg1006" width="1381.630615234375" height="916.0567855834961" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"><marker id="SvgjsMarker1016" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1017" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1026" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1027" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1058" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1059" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1062" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1063" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1074" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1075" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1084" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1085" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1096" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1097" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1108" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1109" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1126" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1127" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1156" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1157" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1174" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1175" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1212" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1213" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1216" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1217" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1234" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1235" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1270" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1271" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1274" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1275" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1284" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1285" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1318" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1319" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker></defs><g id="SvgjsG1008" transform="translate(25.00600857204779,231.06250381469727)"><path id="SvgjsPath1009" d="M 0 4Q 0 0 4 0L 168 0Q 172 0 172 4L 172 66Q 172 70 168 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1010"><text id="SvgjsText1011" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="152px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1012" dy="16" x="86"><tspan id="SvgjsTspan1013" style="text-decoration:;">调用$mount执行挂载</tspan></tspan></text></g></g><g id="SvgjsG1014"><path id="SvgjsPath1015" d="M198.0060085720478 266.06250381469755L226.50600857204802 266.06250381469755L226.50600857204802 266.06250381469755L252.40600857204822 266.06250381469755" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1016)"></path></g><g id="SvgjsG1018" transform="translate(256.00600857204824,231.06250381469727)"><path id="SvgjsPath1019" d="M 0 4Q 0 0 4 0L 168 0Q 172 0 172 4L 172 66Q 172 70 168 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1020"><text id="SvgjsText1021" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="152px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1022" dy="16" x="86"><tspan id="SvgjsTspan1023" style="text-decoration:;">mountComponent</tspan></tspan></text></g></g><g id="SvgjsG1024"><path id="SvgjsPath1025" d="M429.00600857204824 266.06250381469755L457.5060085720485 266.06250381469755L457.5060085720485 266.06250381469755L483.4060085720487 266.06250381469755" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1026)"></path></g><g id="SvgjsG1028" transform="translate(487.0060085720487,231.06250381469727)"><path id="SvgjsPath1029" d="M 0 4Q 0 0 4 0L 96 0Q 100 0 100 4L 100 66Q 100 70 96 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1030"><text id="SvgjsText1031" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="80px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="15.875" transform="rotate(0)"><tspan id="SvgjsTspan1032" dy="16" x="50"><tspan id="SvgjsTspan1033" style="text-decoration:;">实例化渲染</tspan></tspan><tspan id="SvgjsTspan1034" dy="16" x="50"><tspan id="SvgjsTspan1035" style="text-decoration:;">Watcher</tspan></tspan></text></g></g><g id="SvgjsG1036" transform="translate(376.2673782772489,340.06250381469727)"><path id="SvgjsPath1037" d="M 0 0L 305.4772605895996 0L 321.4772605895996 16L 321.4772605895996 140L 0 140L 0 0Z" stroke="none" fill-opacity="1" fill="#ffffaa"></path><path id="SvgjsPath1038" d="M 305.4772605895996 0L 305.4772605895996 16L 321.4772605895996 16Z" stroke="none" fill-opacity="1" fill="#cdcdcd"></path><path id="SvgjsPath1039" d="M 0 0L 305.4772605895996 0L 321.4772605895996 16L 321.4772605895996 140L 0 140L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG1040"><text id="SvgjsText1041" font-family="微软雅黑" text-anchor="start" font-size="13px" width="302px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.375" transform="rotate(0)"><tspan id="SvgjsTspan1042" dy="16" x="10"><tspan id="SvgjsTspan1043" style="text-decoration:;">new Watcher(vm, updateComponent, noop, {</tspan></tspan><tspan id="SvgjsTspan1044" dy="16" x="10"><tspan id="SvgjsTspan1045" style="text-decoration:;">    before () {</tspan></tspan><tspan id="SvgjsTspan1046" dy="16" x="10"><tspan id="SvgjsTspan1047" style="text-decoration:;">      if (vm._isMounted &amp;&amp; !vm._isDestroyed) {</tspan></tspan><tspan id="SvgjsTspan1048" dy="16" x="10"><tspan id="SvgjsTspan1049" style="text-decoration:;">        callHook(vm, 'beforeUpdate')</tspan></tspan><tspan id="SvgjsTspan1050" dy="16" x="10"><tspan id="SvgjsTspan1051" style="text-decoration:;">      }</tspan></tspan><tspan id="SvgjsTspan1052" dy="16" x="10"><tspan id="SvgjsTspan1053" style="text-decoration:;">    }</tspan></tspan><tspan id="SvgjsTspan1054" dy="16" x="10"><tspan id="SvgjsTspan1055" style="text-decoration:;">  }, true /* isRenderWatcher */)</tspan></tspan></text></g></g><g id="SvgjsG1056"><path id="SvgjsPath1057" d="M537.0060085720487 302.06250381469727L537.0060085720487 321.27399995591907L537.0060085720487 321.27399995591907L537.0060085720487 337.46250381469724" stroke-dasharray="3,3" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1058)"></path></g><g id="SvgjsG1060"><path id="SvgjsPath1061" d="M588.0060085720487 266.06250381469755L616.5060085720489 266.06250381469755L616.5060085720489 266.06250381469755L642.4060085720491 266.06250381469755" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1062)"></path></g><g id="SvgjsG1064" transform="translate(646.0060085720492,231.06250381469727)"><path id="SvgjsPath1065" d="M 0 4Q 0 0 4 0L 186.77524142795085 0Q 190.77524142795085 0 190.77524142795085 4L 190.77524142795085 66Q 190.77524142795085 70 186.77524142795085 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1066"><text id="SvgjsText1067" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="171px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="15.875" transform="rotate(0)"><tspan id="SvgjsTspan1068" dy="16" x="95.5"><tspan id="SvgjsTspan1069" style="text-decoration:;">Watcher的constructor调用</tspan></tspan><tspan id="SvgjsTspan1070" dy="16" x="95.5"><tspan id="SvgjsTspan1071" style="text-decoration:;">this.get()</tspan></tspan></text></g></g><g id="SvgjsG1072"><path id="SvgjsPath1073" d="M837.78125 266.0625038146975L865.5186292860246 266.0625038146975L865.5186292860246 266.0625038146975L890.6560085720494 266.0625038146975" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1074)"></path></g><g id="SvgjsG1076" transform="translate(894.2560085720493,228.56250381469727)"><path id="SvgjsPath1077" d="M 0 4Q 0 0 4 0L 153 0Q 157 0 157 4L 157 71Q 157 75 153 75L 4 75Q 0 75 0 71Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1078"><text id="SvgjsText1079" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="137px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="26.875" transform="rotate(0)"><tspan id="SvgjsTspan1080" dy="16" x="78.5"><tspan id="SvgjsTspan1081" style="text-decoration:;">pushTarget(this)</tspan></tspan></text></g></g><g id="SvgjsG1082"><path id="SvgjsPath1083" d="M1052.2560085720493 264.02399995591935L1081.9596448749976 264.02399995591935L1081.9596448749976 264.49442392332963L1109.063281177946 264.49442392332963" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1084)"></path></g><g id="SvgjsG1086" transform="translate(1108.1420440673828,231.06250381469727)"><path id="SvgjsPath1087" d="M 0 4Q 0 0 4 0L 240 0Q 244 0 244 4L 244 66Q 244 70 240 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1088"><text id="SvgjsText1089" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="224px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="15.875" transform="rotate(0)"><tspan id="SvgjsTspan1090" dy="16" x="122"><tspan id="SvgjsTspan1091" style="text-decoration:;">value = this.getter.call(vm, vm)</tspan></tspan><tspan id="SvgjsTspan1092" dy="16" x="122"><tspan id="SvgjsTspan1093" style="text-decoration:;">this.getter === updateComponent</tspan></tspan></text></g></g><g id="SvgjsG1094"><path id="SvgjsPath1095" d="M1230.1420440673828 302.06250381469727L1230.1420440673828 335.56250381469727L1230.1420440673828 335.56250381469727L1230.1420440673828 366.46250381469724" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1096)"></path></g><g id="SvgjsG1098" transform="translate(1108.1420440673828,370.06250381469727)"><path id="SvgjsPath1099" d="M 0 4Q 0 0 4 0L 240 0Q 244 0 244 4L 244 76Q 244 80 240 80L 4 80Q 0 80 0 76Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1100"><text id="SvgjsText1101" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="224px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="20.875" transform="rotate(0)"><tspan id="SvgjsTspan1102" dy="16" x="122"><tspan id="SvgjsTspan1103" style="text-decoration:;">vm._update(vm._render(), </tspan></tspan><tspan id="SvgjsTspan1104" dy="16" x="122"><tspan id="SvgjsTspan1105" style="text-decoration:;">hydrating)</tspan></tspan></text></g></g><g id="SvgjsG1106"><path id="SvgjsPath1107" d="M1107.1420440673828 410.0625038146972L1079.1878237194496 410.0625038146972L1079.1878237194496 410.0625038146972L1049.7420440673827 410.0625038146972" stroke-dasharray="3,3" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1108)"></path></g><g id="SvgjsG1110" transform="translate(767.1420440673827,364.56250381469727)"><path id="SvgjsPath1111" d="M 0 0L 264 0L 280 16L 280 91L 0 91L 0 0Z" stroke="none" fill-opacity="1" fill="#ffffaa"></path><path id="SvgjsPath1112" d="M 264 0L 264 16L 280 16Z" stroke="none" fill-opacity="1" fill="#cdcdcd"></path><path id="SvgjsPath1113" d="M 0 0L 264 0L 280 16L 280 91L 0 91L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG1114"><text id="SvgjsText1115" font-family="微软雅黑" text-anchor="start" font-size="13px" width="260px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.375" transform="rotate(0)"><tspan id="SvgjsTspan1116" dy="16" x="10"><tspan id="SvgjsTspan1117" style="text-decoration:;">它会先执⾏ vm._render() ⽅法，因为之前分</tspan></tspan><tspan id="SvgjsTspan1118" dy="16" x="10"><tspan id="SvgjsTspan1119" style="text-decoration:;">析过这个⽅法会⽣成 渲染 VNode，并且在这</tspan></tspan><tspan id="SvgjsTspan1120" dy="16" x="10"><tspan id="SvgjsTspan1121" style="text-decoration:;">个过程中会对 vm 上的数据访问，这个时候</tspan></tspan><tspan id="SvgjsTspan1122" dy="16" x="10"><tspan id="SvgjsTspan1123" style="text-decoration:;">就触发了数据对象的 getter</tspan></tspan></text></g></g><g id="SvgjsG1124"><path id="SvgjsPath1125" d="M972.756008572049 227.56250381469727L972.756008572049 213.59975899590387L972.756008572049 213.59975899590387L972.756008572049 201.23701417711047" stroke-dasharray="3,3" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1126)"></path></g><g id="SvgjsG1128" transform="translate(719.0846099853516,25.00064129299591)"><path id="SvgjsPath1129" d="M 0 0L 491.3427971733954 0L 507.3427971733954 16L 507.3427971733954 173.63637288411456L 0 173.63637288411456L 0 0Z" stroke="none" fill-opacity="1" fill="#ffffaa"></path><path id="SvgjsPath1130" d="M 491.3427971733954 0L 491.3427971733954 16L 507.3427971733954 16Z" stroke="none" fill-opacity="1" fill="#cdcdcd"></path><path id="SvgjsPath1131" d="M 0 0L 491.3427971733954 0L 507.3427971733954 16L 507.3427971733954 173.63637288411456L 0 173.63637288411456L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG1132"><text id="SvgjsText1133" font-family="微软雅黑" text-anchor="start" font-size="13px" width="488px" fill="#323232" font-weight="400" align="top" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.375" transform="rotate(0)"><tspan id="SvgjsTspan1134" dy="16" x="10"><tspan id="SvgjsTspan1135" style="text-decoration:;">// The current target watcher being evaluated.</tspan></tspan><tspan id="SvgjsTspan1136" dy="16" x="10"><tspan id="SvgjsTspan1137" style="text-decoration:;">// This is globally unique because only one watcher</tspan></tspan><tspan id="SvgjsTspan1138" dy="16" x="10"><tspan id="SvgjsTspan1139" style="text-decoration:;">// can be evaluated at a time.</tspan></tspan><tspan id="SvgjsTspan1140" dy="16" x="10"><tspan id="SvgjsTspan1141" style="text-decoration:;">Dep.target = null</tspan></tspan><tspan id="SvgjsTspan1142" dy="16" x="10"><tspan id="SvgjsTspan1143" style="text-decoration:;">export function pushTarget (_target: Watcher) {</tspan></tspan><tspan id="SvgjsTspan1144" dy="16" x="10"><tspan id="SvgjsTspan1145" style="text-decoration:;">  if (Dep.target) targetStack.push(Dep.target)</tspan></tspan><tspan id="SvgjsTspan1146" dy="16" x="10"><tspan id="SvgjsTspan1147" style="text-decoration:;">  Dep.target = _target</tspan></tspan><tspan id="SvgjsTspan1148" dy="16" x="10"><tspan id="SvgjsTspan1149" style="text-decoration:;">}</tspan></tspan><tspan id="SvgjsTspan1150" dy="16" x="10"><tspan id="SvgjsTspan1151" style="text-decoration:;">Dep.target是全局唯一的，因为在一段时间内只会有一个Watcher被收集依赖</tspan></tspan><tspan id="SvgjsTspan1152" dy="16" x="10"><tspan id="SvgjsTspan1153" style="text-decoration:;">实际上就是把 Dep.target 赋值为当前的渲染 watcher 并压栈（为了恢复⽤）。</tspan></tspan></text></g></g><g id="SvgjsG1154"><path id="SvgjsPath1155" d="M1228.074644038974 451.06250381469727L1228.074644038974 473.18643902565066L1228.074644038974 473.18643902565066L1228.074644038974 492.710374236604" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1156)"></path></g><g id="SvgjsG1158" transform="translate(1104.6420440673828,493.06250381469727)"><path id="SvgjsPath1159" d="M 0 4Q 0 0 4 0L 247 0Q 251 0 251 4L 251 87Q 251 91 247 91L 4 91Q 0 91 0 87Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1160"><text id="SvgjsText1161" font-family="微软雅黑" text-anchor="start" font-size="13px" width="231px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1162" dy="16" x="10"><tspan id="SvgjsTspan1163" style="text-decoration:;">在initState时，defineReactive会给每</tspan></tspan><tspan id="SvgjsTspan1164" dy="16" x="10"><tspan id="SvgjsTspan1165" style="text-decoration:;">个对象值的 getter 都new⼀个 dep ，</tspan></tspan><tspan id="SvgjsTspan1166" dy="16" x="10"><tspan id="SvgjsTspan1167" style="text-decoration:;">在触发 getter 的时候会调⽤ </tspan></tspan><tspan id="SvgjsTspan1168" dy="16" x="10"><tspan id="SvgjsTspan1169" style="text-decoration:;">dep.depend() ⽅法，也就会执⾏ </tspan></tspan><tspan id="SvgjsTspan1170" dy="16" x="10"><tspan id="SvgjsTspan1171" style="text-decoration:;">Dep.target.addDep(this)</tspan></tspan></text></g></g><g id="SvgjsG1172"><path id="SvgjsPath1173" d="M1230.1420440673828 585.0625038146973L1230.1420440673828 612.6576728820801L1230.1420440673828 612.6576728820801L1230.1420440673828 637.6528419494629" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1174)"></path></g><g id="SvgjsG1176" transform="translate(1104.6420440673828,641.2528419494629)"><path id="SvgjsPath1177" d="M 0 4Q 0 0 4 0L 247 0Q 251 0 251 4L 251 73.61932373046875Q 251 77.61932373046875 247 77.61932373046875L 4 77.61932373046875Q 0 77.61932373046875 0 73.61932373046875Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1178"><text id="SvgjsText1179" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="231px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="19.684661865234375" transform="rotate(0)"><tspan id="SvgjsTspan1180" dy="16" x="125.5"><tspan id="SvgjsTspan1181" style="text-decoration:;">这个时候 Dep.target 已经被赋值为渲染 </tspan></tspan><tspan id="SvgjsTspan1182" dy="16" x="125.5"><tspan id="SvgjsTspan1183" style="text-decoration:;">watcher ，那么就执⾏到 addDep</tspan></tspan></text></g></g><g id="SvgjsG1184" transform="translate(771.2560085720495,534.8655364778311)"><path id="SvgjsPath1185" d="M 0 0L 264 0L 280 16L 280 164.69696733686624L 0 164.69696733686624L 0 0Z" stroke="none" fill-opacity="1" fill="#ffffaa"></path><path id="SvgjsPath1186" d="M 264 0L 264 16L 280 16Z" stroke="none" fill-opacity="1" fill="#cdcdcd"></path><path id="SvgjsPath1187" d="M 0 0L 264 0L 280 16L 280 164.69696733686624L 0 164.69696733686624L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG1188"><text id="SvgjsText1189" font-family="微软雅黑" text-anchor="start" font-size="13px" width="260px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="-1.7765163315668815" transform="rotate(0)"><tspan id="SvgjsTspan1190" dy="16" x="10"><tspan id="SvgjsTspan1191" style="text-decoration:;">addDep (dep: Dep) {</tspan></tspan><tspan id="SvgjsTspan1192" dy="16" x="10"><tspan id="SvgjsTspan1193" style="text-decoration:;">  const id = dep.id</tspan></tspan><tspan id="SvgjsTspan1194" dy="16" x="10"><tspan id="SvgjsTspan1195" style="text-decoration:;">  if (!this.newDepIds.has(id)) {</tspan></tspan><tspan id="SvgjsTspan1196" dy="16" x="10"><tspan id="SvgjsTspan1197" style="text-decoration:;">    this.newDepIds.add(id)</tspan></tspan><tspan id="SvgjsTspan1198" dy="16" x="10"><tspan id="SvgjsTspan1199" style="text-decoration:;">    this.newDeps.push(dep)</tspan></tspan><tspan id="SvgjsTspan1200" dy="16" x="10"><tspan id="SvgjsTspan1201" style="text-decoration:;">    if (!this.depIds.has(id)) {</tspan></tspan><tspan id="SvgjsTspan1202" dy="16" x="10"><tspan id="SvgjsTspan1203" style="text-decoration:;">      dep.addSub(this)</tspan></tspan><tspan id="SvgjsTspan1204" dy="16" x="10"><tspan id="SvgjsTspan1205" style="text-decoration:;">    }</tspan></tspan><tspan id="SvgjsTspan1206" dy="16" x="10"><tspan id="SvgjsTspan1207" style="text-decoration:;">  }</tspan></tspan><tspan id="SvgjsTspan1208" dy="16" x="10"><tspan id="SvgjsTspan1209" style="text-decoration:;">}</tspan></tspan></text></g></g><g id="SvgjsG1210"><path id="SvgjsPath1211" d="M1103.6420440673828 680.0625038146973L1077.9490263197163 680.0625038146973L1077.9490263197163 617.2140201462641L1053.8560085720494 617.2140201462641" stroke-dasharray="3,3" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1212)"></path></g><g id="SvgjsG1214"><path id="SvgjsPath1215" d="M1230.1420440673828 719.8721656799316L1230.1420440673828 751.9673347473145L1230.1420440673828 751.9673347473145L1230.1420440673828 781.4625038146972" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1216)"></path></g><g id="SvgjsG1218" transform="translate(1104.6420440673828,785.0625038146973)"><path id="SvgjsPath1219" d="M 0 4Q 0 0 4 0L 247 0Q 251 0 251 4L 251 102Q 251 106 247 106L 4 106Q 0 106 0 102Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1220"><text id="SvgjsText1221" font-family="微软雅黑" text-anchor="start" font-size="13px" width="231px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.875" transform="rotate(0)"><tspan id="SvgjsTspan1222" dy="16" x="10"><tspan id="SvgjsTspan1223" style="text-decoration:;">执⾏ dep.addSub(this) ，那么就会执</tspan></tspan><tspan id="SvgjsTspan1224" dy="16" x="10"><tspan id="SvgjsTspan1225" style="text-decoration:;">⾏ this.subs.push(sub) ，也就是说把当</tspan></tspan><tspan id="SvgjsTspan1226" dy="16" x="10"><tspan id="SvgjsTspan1227" style="text-decoration:;">前的 watcher 订阅到这个数据持有的 </tspan></tspan><tspan id="SvgjsTspan1228" dy="16" x="10"><tspan id="SvgjsTspan1229" style="text-decoration:;">dep 的 subs中，这个⽬的是为后续数据</tspan></tspan><tspan id="SvgjsTspan1230" dy="16" x="10"><tspan id="SvgjsTspan1231" style="text-decoration:;">变化时候能通知到哪些 subs 做准备</tspan></tspan></text></g></g><g id="SvgjsG1232"><path id="SvgjsPath1233" d="M1103.6420440673828 838.0625038146973L1072.8920440673828 838.0625038146973L1072.8920440673828 838.0625038146973L1044.7420440673827 838.0625038146973" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1234)"></path></g><g id="SvgjsG1236" transform="translate(845.4299262364714,800.5625038146973)"><path id="SvgjsPath1237" d="M 0 4Q 0 0 4 0L 191.71211783091144 0Q 195.71211783091144 0 195.71211783091144 4L 195.71211783091144 71Q 195.71211783091144 75 191.71211783091144 75L 4 75Q 0 75 0 71Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1238"><text id="SvgjsText1239" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="176px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.375" transform="rotate(0)"><tspan id="SvgjsTspan1240" dy="16" x="98"><tspan id="SvgjsTspan1241" style="text-decoration:;">对于深度监听 的对象</tspan></tspan><tspan id="SvgjsTspan1242" dy="16" x="98"><tspan id="SvgjsTspan1243" style="text-decoration:;">要递归去访问 value ，触发它</tspan></tspan><tspan id="SvgjsTspan1244" dy="16" x="98"><tspan id="SvgjsTspan1245" style="text-decoration:;">所有⼦项的 getter</tspan></tspan><tspan id="SvgjsTspan1246" dy="16" x="98"><tspan id="SvgjsTspan1247" style="text-decoration:;"> </tspan></tspan></text></g></g><g id="SvgjsG1248" transform="translate(567.9734988742405,803.0625038146973)"><path id="SvgjsPath1249" d="M 0 4Q 0 0 4 0L 218.65750969780868 0Q 222.65750969780868 0 222.65750969780868 4L 222.65750969780868 66Q 222.65750969780868 70 218.65750969780868 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1250"><text id="SvgjsText1251" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="203px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="15.875" transform="rotate(0)"><tspan id="SvgjsTspan1252" dy="16" x="111.5"><tspan id="SvgjsTspan1253" style="text-decoration:;">popTarget()，这个watcher的依赖</tspan></tspan><tspan id="SvgjsTspan1254" dy="16" x="111.5"><tspan id="SvgjsTspan1255" style="text-decoration:;">收集完了，恢复Dep.target</tspan></tspan></text></g></g><g id="SvgjsG1256" transform="translate(877.2859851519272,715.0625038146973)"><path id="SvgjsPath1257" d="M 0 0L 116 0L 132 16L 132 70L 0 70L 0 0Z" stroke="none" fill-opacity="1" fill="#ffffaa"></path><path id="SvgjsPath1258" d="M 116 0L 116 16L 132 16Z" stroke="none" fill-opacity="1" fill="#cdcdcd"></path><path id="SvgjsPath1259" d="M 0 0L 116 0L 132 16L 132 70L 0 70L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG1260"><text id="SvgjsText1261" font-family="微软雅黑" text-anchor="start" font-size="13px" width="112px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1262" dy="16" x="10"><tspan id="SvgjsTspan1263" style="text-decoration:;">if (this.deep) {</tspan></tspan><tspan id="SvgjsTspan1264" dy="16" x="10"><tspan id="SvgjsTspan1265" style="text-decoration:;">    traverse(value)</tspan></tspan><tspan id="SvgjsTspan1266" dy="16" x="10"><tspan id="SvgjsTspan1267" style="text-decoration:;">}</tspan></tspan></text></g></g><g id="SvgjsG1268"><path id="SvgjsPath1269" d="M844.4299262364714 839.3352241516113L818.0304674042602 839.3352241516113L818.0304674042602 839.3352241516113L794.2310085720492 839.3352241516113" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1270)"></path></g><g id="SvgjsG1272"><path id="SvgjsPath1273" d="M566.9734988742405 838.0625038146973L546.1204385757446 838.0625038146973L546.1204385757446 838.0625038146973L527.8673782772489 838.0625038146973" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1274)"></path></g><g id="SvgjsG1276" transform="translate(376.2673782772489,803.0625038146973)"><path id="SvgjsPath1277" d="M 0 4Q 0 0 4 0L 144 0Q 148 0 148 4L 148 66Q 148 70 144 70L 4 70Q 0 70 0 66Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1278"><text id="SvgjsText1279" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="128px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="24.375" transform="rotate(0)"><tspan id="SvgjsTspan1280" dy="16" x="74"><tspan id="SvgjsTspan1281" style="text-decoration:;">this.cleanupDeps()</tspan></tspan></text></g></g><g id="SvgjsG1282"><path id="SvgjsPath1283" d="M450.2673782772488 802.0625038146973L450.2673782772488 794.0625038146973L450.26737827724867 794.0625038146973L450.26737827724867 787.6625038146974" stroke-dasharray="3,3" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1284)"></path></g><g id="SvgjsG1286" transform="translate(294.95369529724076,628.6988687515261)"><path id="SvgjsPath1287" d="M 0 0L 294.62736596001616 0L 310.62736596001616 16L 310.62736596001616 156.36363506317127L 0 156.36363506317127L 0 0Z" stroke="none" fill-opacity="1" fill="#ffffaa"></path><path id="SvgjsPath1288" d="M 294.62736596001616 0L 294.62736596001616 16L 310.62736596001616 16Z" stroke="none" fill-opacity="1" fill="#cdcdcd"></path><path id="SvgjsPath1289" d="M 0 0L 294.62736596001616 0L 310.62736596001616 16L 310.62736596001616 156.36363506317127L 0 156.36363506317127L 0 0Z" stroke="none" fill="none"></path><g id="SvgjsG1290"><text id="SvgjsText1291" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="291px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="2.5568175315856365" transform="rotate(0)"><tspan id="SvgjsTspan1292" dy="16" x="155.5"><tspan id="SvgjsTspan1293" style="text-decoration:;">清理依赖信息，我们可以看到调用addDep收集的</tspan></tspan><tspan id="SvgjsTspan1294" dy="16" x="155.5"><tspan id="SvgjsTspan1295" style="text-decoration:;">时候是往newDeps中存，然后遍历deps, 如果</tspan></tspan><tspan id="SvgjsTspan1296" dy="16" x="155.5"><tspan id="SvgjsTspan1297" style="text-decoration:;">newDeps中没有，deps中有就需要移除。比如我</tspan></tspan><tspan id="SvgjsTspan1298" dy="16" x="155.5"><tspan id="SvgjsTspan1299" style="text-decoration:;">们v-if控制渲染A模板，B模板，开始为true渲染</tspan></tspan><tspan id="SvgjsTspan1300" dy="16" x="155.5"><tspan id="SvgjsTspan1301" style="text-decoration:;">A，收集A模板里面的依赖，当条件变成false渲染</tspan></tspan><tspan id="SvgjsTspan1302" dy="16" x="155.5"><tspan id="SvgjsTspan1303" style="text-decoration:;">B，newDeps中就是B的依赖，这时候deps中A相</tspan></tspan><tspan id="SvgjsTspan1304" dy="16" x="155.5"><tspan id="SvgjsTspan1305" style="text-decoration:;">关的依赖就会被清理，数据变更时就不会触发A模</tspan></tspan><tspan id="SvgjsTspan1306" dy="16" x="155.5"><tspan id="SvgjsTspan1307" style="text-decoration:;">板里面的依赖更新，不会有任何浪费</tspan></tspan><tspan id="SvgjsTspan1308" dy="16" x="155.5"><tspan id="SvgjsTspan1309" style="text-decoration:;">Vue的细节处理太棒了</tspan></tspan></text></g></g><g id="SvgjsG1310" transform="translate(25.00600857204779,155.56250381469724)"><path id="SvgjsPath1311" d="M 0 0L 172 0L 172 65L 0 65Z" stroke="none" fill="none"></path><g id="SvgjsG1312"><text id="SvgjsText1313" font-family="微软雅黑" text-anchor="start" font-size="18px" width="172px" fill="#f44336" font-weight="700" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="18px" weight="700" font-style="" opacity="1" y="16.75" transform="rotate(0)"><tspan id="SvgjsTspan1314" dy="22" x="0"><tspan id="SvgjsTspan1315" style="text-decoration:;">Vue依赖收集过程</tspan></tspan></text></g></g><g id="SvgjsG1316"><path id="SvgjsPath1317" d="M943.285985151927 799.5625038146973L943.285985151927 792.8125038146973L943.2859851519272 792.8125038146973L943.2859851519272 787.6625038146973" stroke-dasharray="3,3" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1318)"></path></g></svg>